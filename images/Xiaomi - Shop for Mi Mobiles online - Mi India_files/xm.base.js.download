!function(){function e(){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},t=/&(?!#?\w+;)|<|>|"|'|\//g;return function(){return this?this.replace(t,function(t){return e[t]||t}):this}}function t(e,i,n){return("string"==typeof i?i:i.toString()).replace(e.define||r,function(t,i,o,a){return 0===i.indexOf("def.")&&(i=i.substring(4)),i in n||(":"===o?(e.defineParams&&a.replace(e.defineParams,function(e,t,o){n[i]={arg:t,text:o}}),i in n||(n[i]=a)):new Function("def","def['"+i+"']="+a)(n)),""}).replace(e.use||r,function(i,o){e.useParams&&(o=o.replace(e.useParams,function(e,t,i,o){if(n[i]&&n[i].arg&&o){var a=(i+":"+o).replace(/'|\\/g,"_");return n.__exp=n.__exp||{},n.__exp[a]=n[i].text.replace(new RegExp("(^|[^\\w$])"+n[i].arg+"([^\\w$])","g"),"$1"+o+"$2"),t+"def.__exp['"+a+"']"}}));var a=new Function("def","return "+o)(n);return a?t(e,a,n):a})}function i(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var n,o={version:"1.0.0",templateSettings:{evaluate:/\{\{([\s\S]+?\}?)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1},template:void 0,compile:void 0};"undefined"!=typeof module&&module.exports?module.exports=o:"function"==typeof define&&define.amd?define("source/js/themes/pandora/_plugins/doT",[],function(){return o}):(n=function(){return this||(0,eval)("this")}(),n.doT=o),String.prototype.encodeHTML=e();var a={append:{start:"'+(",end:")+'",endencode:"||'').toString().encodeHTML()+'"},split:{start:"';out+=(",end:");out+='",endencode:"||'').toString().encodeHTML();out+='"}},r=/$^/;o.template=function(n,s,c){s=s||o.templateSettings;var l,u,d=s.append?a.append:a.split,h=0,m=s.use||s.define?t(s,n,c||{}):n;m=("var out='"+(s.strip?m.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):m).replace(/'|\\/g,"\\$&").replace(s.interpolate||r,function(e,t){return d.start+i(t)+d.end}).replace(s.encode||r,function(e,t){return l=!0,d.start+i(t)+d.endencode}).replace(s.conditional||r,function(e,t,n){return t?n?"';}else if("+i(n)+"){out+='":"';}else{out+='":n?"';if("+i(n)+"){out+='":"';}out+='"}).replace(s.iterate||r,function(e,t,n,o){return t?(h+=1,u=o||"i"+h,t=i(t),"';var arr"+h+"="+t+";if(arr"+h+"){var "+n+","+u+"=-1,l"+h+"=arr"+h+".length-1;while("+u+"<l"+h+"){"+n+"=arr"+h+"["+u+"+=1];out+='"):"';} } out+='"}).replace(s.evaluate||r,function(e,t){return"';"+i(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,"").replace(/(\s|;|\}|^|\{)out\+=''\+/g,"$1out+="),l&&s.selfcontained&&(m="String.prototype.encodeHTML=("+e.toString()+"());"+m);try{return new Function(s.varname,m)}catch(e){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+m),e}},o.compile=function(e,t){return o.template(e,null,t)}}(),+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in t)if(void 0!==e.style[i])return{end:t[i]};return!1}e.fn.emulateTransitionEnd=function(t){var i=!1,n=this;e(this).one(e.support.transition.end,function(){i=!0});var o=function(){i||e(n).trigger(e.support.transition.end)};return setTimeout(o,t),this},e(function(){e.support.transition=t()})}(jQuery),!function(e){var t=function(t,i){this.options=i,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,i=e.Event("show");this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.escape(),this.backdrop(function(){var i=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),i&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1),t.enforceFocus(),i?t.$element.one(e.support.transition.end,function(){t.$element.focus().trigger("shown")}):t.$element.focus().trigger("shown")}))},hide:function(t){t&&t.preventDefault();t=e.Event("hide"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]===e.target||t.$element.has(e.target).length||t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){27==t.which&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,i=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(i),t.hideModal()})},hideModal:function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var n=e.support.transition&&i,o=e(document).height(),a="100%";if(this.$backdrop=e('<div class="modal-backdrop '+i+'" />').appendTo(document.body),this.$backdrop.css({width:a,height:o}).click("static"==this.options.backdrop?e.proxy(this.$element[0].focus,this.$element[0]):e.proxy(this.hide,this)),n&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;n?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t):t()):t&&t()}};var i=e.fn.modal;e.fn.modal=function(i){return this.each(function(){var n=e(this),o=n.data("modal"),a=e.extend({},e.fn.modal.defaults,n.data(),"object"==typeof i&&i);o||n.data("modal",o=new t(this,a)),"string"==typeof i?o[i]():a.show&&o.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=i,this},e(document).on("click.modal.data-api",'[data-toggle="modal"]',function(t){var i=e(this),n=i.attr("href"),o=e(i.attr("data-target")||n&&n.replace(/.*(?=#[^\s]+$)/,"")),a=o.data("modal")?"toggle":e.extend({remote:!/#/.test(n)&&n},o.data(),i.data());t.preventDefault(),o.modal(a).one("hide",function(){i.focus()})})}(window.jQuery),window.MICONTST=$.extend(window.MICONTST,{CODE:{ADDCARTSUC:0,MAXITEMNUM:2003009,GODAMIAO:90001,GODAMIAONOTLOGIN:80003}}),Xiaomi=function(e){this.globalConfig=$.extend({},e)};var saleLimit=!1,miscInfoDef;!function(){function e(e){this.context=e;var t=this;if(this.userId=Xiaomi.utils.cookie("userId"),this.userName="",this.msgNum="",this.hasReview="",!this.userId)return!1;var i=Xiaomi.utils.cookie("XM_"+this.userId+"_UN");if(this.userName=this.userId?i?i.replace(/[<>]/g,""):i:"","in"===t.context.globalConfig.appLocal.name){var n=Xiaomi.utils.cookie("msgNum");this.msgNum=n;var o=Xiaomi.utils.cookie("hasReview");this.hasReview=o,null!=this.msgNum&&null!=this.hasReview||(miscInfoDef=$.ajax({url:("https"==t.context.globalConfig.protocol?t.context.globalConfig.httpsOrderSite:t.context.globalConfig.orderSite)+"/misc/info",timeout:5e3,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"info",cache:!1}),miscInfoDef.then(function(e){e&&0==e.errno&&(t.msgNum=e.data.unread,Xiaomi.utils.cookie("msgNum",t.msgNum,{expires:.0035,path:"/"+t.context.globalConfig.appLocal.name,domain:".mi.com"}),Xiaomi.utils.cookie("hasReview",e.data.unreviewed,{expires:7,path:"/"+t.context.globalConfig.appLocal.name,domain:".mi.com"}),t.signedIn())}))}this.userName?this.signedIn():$.ajax({url:"https://account.xiaomi.com/pass/userInfoJsonP?callback=?",data:{userId:this.userId},dataType:"jsonp",success:function(e){e&&e.userId&&(t.userName=e.miliaoInfo&&e.miliaoInfo.nickName?e.miliaoInfo.nickName:e.userId,t.context.localCookie("XM_"+e.userId+"_UN",t.userName),t.signedIn())}})}var t;Xiaomi.prototype.logonUser=function(){return t=t||new e(this)},e.prototype.signedIn=function(){if($("#J_userName").text(this.userName||this.userId),$("#J_signEntries").hide(),$("#J_signedUser").show(),this.msgNum&&this.msgNum>0){var e=this.msgNum;parseInt(this.msgNum)>99&&(e="99<b>+</b>"),$("#J_msgNum").html("("+e+")").show()}this.hasReview&&"true"===this.hasReview?$(".J_topReview").addClass("current"):$(".J_topReview").removeClass("current")}}(),Xiaomi.prototype.proxyIframe=function(e,t){var i='<iframe src="'+("https"==this.globalConfig.protocol?this.globalConfig.httpsOrderSite:this.globalConfig.orderSite)+'/login/proxy" width="0" height="0" name="proxy" id="proxy" frameborder="0" scrolling="no"></iframe>';$(document.body).append(i),$("iframe[name=proxy]").load(function(){"function"==typeof e&&e.call(t),$(this).remove()})},Xiaomi.prototype.localCookie=function(e,t){var i={path:"/"+this.globalConfig.appLocal.name,domain:".mi.com"};Xiaomi.utils.cookie(e,t,i)},Xiaomi.utils={cookie:function(e,t,i){if(arguments.length>1&&"[object Object]"!==String(t)){if(i=jQuery.extend({},i),"undefined"!=typeof t&&null!=t||(i.expires=-1),"number"==typeof i.expires){var n=i.expires,o=i.expires=new Date;o.setDate(o.getDate()+n)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",i.raw?t:encodeURIComponent(t),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}i=t||{};var a,r=i.raw?function(e){return e}:decodeURIComponent;return(a=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?r(a[1].replace(/\+/g,"%20")):null},jsonp:function(e){var t={error:function(){},success:function(t){var i=0;if("undefined"!=typeof t.errno)i=t.errno;else{if("undefined"==typeof t.code)return console.log("Error Format Interface"),!1;i=t.code}if(0===parseInt(i))e.successcallback&&e.successcallback(t);else if(20006===parseInt(i)){var n=GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl=";window.location.href=n+window.location.href}else e.errorcallback&&e.errorcallback(t)},timeout:5e3,dataType:"jsonp",jsonp:"jsonpcallback",cache:!1},i=$.extend({},t,e);$.ajax(i)},login:function(){var e=GLOBAL_CONFIG.orderSite+"/site/login?redirectUrl=";window.location.href=e+window.location.href}},Xiaomi.formatNum=function(e,t){"number"!=typeof e&&(e*=1),"id"!==t&&(e=e.toFixed(2)),e=parseFloat((e+"").replace(/[^\d\.-]/g,""))+"";var i,n,o=(e+"").split(".")[0].split(""),a=e.split(".")[1];for(i="id"===t?".":"in"===t?",":"",n=o.length;n>3;n-=3)o.splice(n-3,0,i);return a?o.join("")+"."+a:o.join("")},function(){function e(e){this.context=e;var t=this,i=!1;this.miniCartEntry=$("#J_miniCartEntry"),this.cartNum,this.itemListTemplate=doT.template($("#J_miniCartItemListTemplate").html()),this.updateCartNum(),this.removing=!1,this.miniCartEntry.on("click",".J_itemRemove",function(){var e=$(this).data("gid");return t.removeGoods(e),!1}).on("mouseHover.miniCart.mi",function(){i||(t.miniCartEntry.find(".loading").show().siblings().hide(),t.removing=!1,t.getData())})}var t;Xiaomi.prototype.loadMiniCart=function(){return t=t||new e(this)},e.prototype.updateCartNum=function(){this.cartNum=Xiaomi.utils.cookie("xm_user_"+this.context.globalConfig.appLocal.name+"_num"),this.cartNum&&parseInt(this.cartNum)>0?($("#J_miniCartNum").text(this.cartNum),$("#J_miniCartIcon").attr("class","iconfont-cartfull-24")):($("#J_miniCartNum").text(0),$("#J_miniCartIcon").attr("class","iconfont-cartempty-24"))},e.prototype.removeGoods=function(e){var t=this;$.ajax({type:"POST",url:("https"==t.context.globalConfig.protocol?t.context.globalConfig.httpsOrderSite:t.context.globalConfig.orderSite)+"/cart/delete/"+e,dataType:"jsonp",jsonp:"jsonpcallback",cache:"false",success:function(e){t.removing=!0,t.getData()}})},e.prototype.getData=function(){var e=this;$.ajax({type:"GET",url:("https"==e.context.globalConfig.protocol?e.context.globalConfig.httpsOrderSite:e.context.globalConfig.orderSite)+"/cart/miniNew",dataType:"jsonp",jsonp:"jsonpcallback",cache:!1,success:function(t){e.formatData(t),e.updateCartNum(),e.miniCartEntry.trigger("contentChanged.mi")}})},e.prototype.formatData=function(e){var t=this;if(t.miniCartEntry.find(".loading").hide(),0==e.errorno){if(!(e.totalItem>0))return t.miniCartEntry.find(".filled-cart").hide().siblings(".empty-cart").show(),!1;t.removing||t.miniCartEntry.find(".empty-cart").hide().siblings(".filled-cart").show();for(var i=0;i<e.items.length;i+=1){var n=e.items[i];n.showType=Xiaomi.CONST.ShowType[n.show_type],"undefined"==typeof n.showType&&(n.showType="")}for(var i=0;i<e.items.length;i++)e.items[i].salePrice=Xiaomi.formatNum(e.items[i].salePrice,GLOBAL_CONFIG.appLocal.name);var o=t.itemListTemplate(e.items);t.removing?t.removingItem(o,function(){t.updateCartSummary(e)}):(t.updateCartSummary(e),$("#J_miniCartItemList").html(o))}},e.prototype.updateCartSummary=function(e){var t="item";e.total>1&&(t="items"),$("#J_miniCartItemCount").text(e.total+" "+t),$("#J_miniCartSumPrice").text(Xiaomi.formatNum(e.totalPrice,GLOBAL_CONFIG.appLocal.name))},e.prototype.removingItem=function(e,t){for(var i=$("#J_miniCartItemList").html().match(/data\-gid=\"[^\"]+\"/g),n=e.match(/data\-gid=\"([^\"]+)\"/g),o=0;o<i.length;o++){for(var a=0;a<n.length&&i[o]!=n[a];a++);a==n.length&&$("#J_miniCartItemList li:eq("+o+")").animate({height:0,opacity:0},"fast",function(){$(this).remove(),t()})}}}(),function(){function e(e){this.context=e}function t(e,t){this.context=t,this.config={sku:null,callback:null,sourceVal:"bigtap"},this.inTheQueue=!1,$.extend(this.config,e),this.startQueue(),this.getDmSys();var i=this;$("#xmDmReload").on("click",function(){i.startQueue(),i.getDmSys()})}var i;Xiaomi.prototype.cart=function(){return i=i||new e(this)},e.prototype.cartAdd=function(e,t,i){var n=this;$.ajax({url:e,dataType:"jsonp",jsonp:"jsonpcallback",success:function(e){if(i&&i(e),e&&0===e.code){var o="xm_user_"+n.context.globalConfig.appLocal.name+"_num",a=Xiaomi.utils.cookie(o);n.context.localCookie(o,Number(a)+1),t&&t(e)}else alert(e.message)}})},e.prototype.addGood=function(e,i,n){e=parseInt(e),this.context.globalConfig.damiaoGoodsId=$.map(this.context.globalConfig.damiaoGoodsId,function(e,t){return parseInt(e)}),$.inArray(e,this.context.globalConfig.damiaoGoodsId)!=-1?Xiaomi.utils.cookie("serviceToken")?new t({sku:e,callback:i},this.context):Xiaomi.utils.cookie("userId")?this.context.proxyIframe(function(){new t({sku:e,callback:i},this.context)},this):window.location.href=this.context.globalConfig.orderSite+"/site/login":n?this.cartAdd(this.context.globalConfig.orderSite+"/cart/add/"+e,i,n):this.cartAdd(this.context.globalConfig.orderSite+"/cart/add/"+e,i)},e.prototype.removeGood=function(e,t){var i=this;$.ajax({type:"POST",url:i.context.globalConfig.orderSite+"/cart/delete/"+e,dataType:"jsonp",jsonp:"jsonpcallback",cache:"false",success:function(e){e&&1===e.deleteBatch?t&&t(e):alert(e.msg)}})},t.prototype.getDmSys=function(){var e=this,t=this.context.globalConfig.damiaoSite+"hdget/"+this.context.globalConfig.appLocal.name+"?source="+this.config.sourceVal+"&product="+this.config.sku+"&addcart=1&m=1&_="+(new Date).getTime();Xiaomi.utils.cookie("WH_warehouse")&&"in"===this.context.globalConfig.appLocal.name&&(t+="&storage="+Xiaomi.utils.cookie("WH_warehouse")),$.ajax({url:t,dataType:"jsonp",jsonp:"jsonpcallback",jsonpCallback:"hdcontrol",timeout:3e4,error:function(){return!!e.inTheQueue&&(e.stopQueue(),void $("#xmDmError").modal({show:!0,backdrop:"static"}))},success:function(t){var n,o=t.status,a=o[e.config.sku].hdurl,r=o[e.config.sku].hdstart===!1&&o[e.config.sku].hdstop===!0,s=t.d22a51?1e3*t.d22a51:5e3;return!!e.inTheQueue&&(r===!0?(e.stopQueue(),alert("We are sorry to tell you this item is sold out."),window.location.reload(),!1):(e.getDmTimer&&clearTimeout(e.getDmTimer),void(a?(n=e.context.globalConfig.orderSite+"/cart/add/"+e.config.sku+"?source="+e.config.sourceVal+"&token="+a,i.cartAdd(n,e.config.callback,$.proxy(e.stopQueue,e))):(e.inTheQueue||e.startQueue(),e.getDmTimer=setTimeout(function(){e.getDmSys()},s)))))}})},t.prototype.startQueue=function(){var e=this;$("#xmDmError").modal("hide"),$("#xmDmQueue").modal({show:!0,backdrop:"static"}),e.queueAnimate(),e.inTheQueue=!0,$("#xmDmQueue").on("hidden.bs.modal",function(){e.stopQueue()})},t.prototype.stopQueue=function(){$("#xmDmQueue").modal("hide"),this.inTheQueue=!1,this.getDmTimer&&clearTimeout(this.getDmTimer),this.queueAnimateTimer&&clearInterval(this.queueAnimateTimer)},t.prototype.queueAnimate=function(){var e=0,t=200,i=function(){e-=90,e<=-900&&(e=0),$("#mituWalking").css({backgroundPosition:e+"px 0"})};this.queueAnimateTimer=setInterval(i,t)}}(),Xiaomi.userCountry={speed:500,currentCountry:"",constructCountrySelect:function(){var e=this,t="",i=Xiaomi.utils.cookie("xm_viewer_locale"),n="";if($(".main-category").each(function(){"STORE"===$(this).find("a").text().trim().toUpperCase()&&(n=$(this))}),$.each(GLOBAL_CONFIG.globalLocales,function(n,o){i===n||i===n.toUpperCase()?(t+='<li class="region-entry global-entry"><a href="javascript:void(0);" class="active"  data-fullname="'+o+'" data-country="'+n+'">'+o+'<i class="iconfont">&#xe932;</i></a></li>',$("#J_selectRegin").text(o).attr("data-region",n),$(".order-entry").show(),$("#J_miniCartEntry").show()):(t+='<li class="region-entry global-entry"><a href="javascript:void(0);" data-country="'+n+'" data-fullname="'+o+'">'+o+"</a></li>",e.currentCountry=i)}),i){var o=!1;$.each(GLOBAL_CONFIG.globalLocales,function(e,t){i!==e&&i!==e.toUpperCase()||(o=!0)}),o?t+='<li class="region-entry global-entry J_international"><a href="'+GLOBAL_CONFIG.wwwSite+'"  data-fullname="International">International</a></li>':(t+='<li class="region-entry global-entry J_international"><a href="'+GLOBAL_CONFIG.wwwSite+'"  data-fullname="International" class="active">International<i class="iconfont">&#xe932;</i></a></li>',$(".order-entry").hide(),$("#J_miniCartEntry").hide(),n&&n.hide(),$("#J_selectRegin").text("International").attr("data-region","en"))}else i="en",t+='<li class="region-entry global-entry J_international"><a href="'+GLOBAL_CONFIG.wwwSite+'"  data-fullname="International" class="active">International<i class="iconfont">&#xe932;</i></a></li>',$(".order-entry").hide(),$("#J_miniCartEntry").hide(),n&&n.hide(),$("#J_selectRegin").text("International").attr("data-region","en");""!==e.currentCountry&&null!==e.currentCountry?$.each(GLOBAL_CONFIG.globalLocalsUrl,function(e,i){t+='<li class="region-entry"><a href="'+i+'">'+e+"</a></li>"}):($.each(GLOBAL_CONFIG.separateSites,function(o,a){i===o||i===o.toUpperCase()?(t+='<li class="region-entry"><a href="'+a.link+'">'+a.title+'<i class="iconfont">&#xe932;</i></a></li>',$("#J_selectRegin").text(a.title).attr("data-region",o),$(".order-entry").show(),$("#J_miniCartEntry").show(),n&&n.show()):(t+='<li class="region-entry global-entry"><a href="'+a.link+'" data-country="'+o+'" data-fullname="'+a.title+'">'+a.title+"</a></li>",e.currentCountry=i,n&&("us"===i||"US"===i?n.show():n.hide()))}),t+='<li class="region-entry global-entry"><a href="http://www.mi.com/mena/" data-country="mena" data-fullname="Mena">Mena</a></li>'),$(".J_regionList ul").html(t),$(".J_regionList").on("click","a",function(){var t=$(this);if(t.closest("li").hasClass("J_international")?($(".order-entry").hide(),$("#J_miniCartEntry").hide()):($(".order-entry").show(),$("#J_miniCartEntry").show()),t.closest("li").hasClass("global-entry")){$(".J_regionList").find("a").each(function(){var e=($(this).data("country"),$(this).data("fullname"));$(this).removeClass("active").html(e)});var i=$(this).attr("data-country")?$(this).attr("data-country"):"en";$("#J_selectRegin").text($(this).text()).attr("data-region",i),$(this).addClass("active").append('<i class="iconfont">&#xe932;</i>'),t.closest("li").hasClass("J_international")?(Xiaomi.utils.cookie("xm_viewer_locale",null,{domain:".mi.com",path:"/"+GLOBAL_CONFIG.appLocal.name,expires:3650}),n&&n.hide()):(Xiaomi.utils.cookie("xm_viewer_locale",null,{domain:".mi.com",path:"/",expires:3650}),setTimeout(function(){e.currentCountry=t.data("country"),Xiaomi.utils.cookie("xm_viewer_locale",e.currentCountry,{domain:".mi.com",path:"/"+GLOBAL_CONFIG.appLocal.name,expires:3650})},300),n&&n.show())}"us"===t.attr("data-country")&&saleLimit?$(".J-btn").show():$(".J-btn").hide()})},init:function(){this.constructCountrySelect()}};var utils={UTC_MAP:{in:5.5,id:7,sg:8,my:8,ph:8,tw:8,hk:8,vn:7},getUTCDate:function(e,t){var i=e,n=this.UTC_MAP[t||xiaomi.globalConfig.appLocal.name]||0,o=new Date(i),a=o.getTimezoneOffset(),r=60*(a+60*n)*1e3,s=i+r;return new Date(s)},getUTCTime:function(e,t){var i=new Date(e),n=this.UTC_MAP[t||xiaomi.globalConfig.appLocal.name]||0,o=i.getTimezoneOffset(),a=60*(o+60*n)*1e3,r=i.getTime()-a;return r},trackGALink:function(e,t){var i=e.href;return ga("send","event",t,"click",{hitCallback:function(){window.location=i}}),!1},checkEmail:function(e){var t;return t=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,!!t.test(e)},checkMobile:function(e,t){var i;switch(t=t||xiaomi.globalConfig.appLocal.name){case"in":i=/^\d{10}$/;break;default:i=/^\d{8,12}$/}return!!i.test(e)},formatPrice:function(e,t){!t&&(t=",");var i=e.toString().split(".");return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,t),i.join(".")}};$.extend(Xiaomi.utils,utils),$(function(){$(".J_foldingEntry").each(function(){var e,t=$(this),i=t.children("a"),n=i.next(),o=200,a=!1;i.mouseover(function(){a||(t.trigger("mouseHover.mi"),t.addClass("hover"),n.animate({height:n.children().outerHeight()},"fast"),a=!0)}),t.hover(function(){e&&clearTimeout(e)},function(){e=setTimeout(function(){n.removeClass("auto-height").animate({height:0},"fast"),t.removeClass("hover"),a=!1,e=null},o)}),t.bind("contentChanged.foldingEntry.mi",function(){a&&n.stop().animate({height:n.children().outerHeight()},"fast",function(){n.addClass("auto-height")})})}),function(){var e=$("#J_curtain"),t=-1,i=!1;$("#J_shopCategories").on("mouseenter",".main-category a",function(){if(i)return!1;var n=$(this).parents(".main-category"),o=n.parent().index();if(n.next().length>0){if(o!=t){$("#J_shopCategories").find("dl").eq(t).children(".products-exhibit").hide();var a=n.next().find(".product-image img");$.each(a,function(e,t){!$(t).attr("src")&&$(t).attr("src",$(t).attr("data-src"))}),t=o,n.next().show()}e.addClass("unfolding")}else e.removeClass("unfolding"),$("#J_shopCategories").find("dl").eq(t).children(".products-exhibit").hide(),t=-1}),$("#J_shopCategories").on("mouseleave",function(){return!i&&(e.removeClass("unfolding"),void(e.hasClass("index")&&($("#J_shopCategories").find("dl").eq(t).children(".products-exhibit").hide(),t=-1)))}),$("#J_searchHandler").on("click",function(){return i?(i=!1,e.removeClass("search-unfolding"),$(".site-search-backdrop").remove(),$(this).children().addClass("iconfont-search-24").removeClass("iconfont-search-close-24"),$("#J_siteSearch").hide(),$("#J_siteSearchQuickLinks").removeClass("show")):(i=!0,e.addClass("search-unfolding"),$("#J_shopCategories").find("dl").eq(t).children(".products-exhibit").hide(),$("body").append('<div class="site-search-backdrop"></div>'),$(this).children().removeClass("iconfont-search-24").addClass("iconfont-search-close-24"),$("#J_siteSearch").show(),$("#J_siteSearchInput").focus(),$("#J_siteSearchQuickLinks").addClass("show")),!1}),$("body").on("click.foldingSearch.mi",function(e){i&&"J_curtain"!=e.target.id&&($(e.target).parents("#J_curtain").length>0&&0==$(e.target).parent(".main-category").length||($("#J_searchHandler").trigger("click"),$(e.target).trigger("mouseenter")))}),$("#J_siteSearchInput").on("keydup paste input",function(){var e=$.trim($(this).val());$("#J_siteSearchSubmit").prop("disabled",""==e)}),$("#J_siteSearchForm").on("submit",function(){var e=$.trim($("#J_siteSearchInput").val());return""!==e&&(e=e.replace(/[\-_'=+|\\\/]/g," "),window.location.href=GLOBAL_CONFIG.orderSite+"/search_"+encodeURIComponent(e)),!1})}(),function(){function e(){n.animate({height:r},"fast"),o.addClass("active"),i=!0}function t(){n.animate({height:0},"fast",function(){o.removeClass("active")}),i=!1}var i=!1,n=$("#J_sitesList"),o=$("#J_siteSwitchHandle"),a=$("#J_siteSwitch"),r=n.children().outerHeight();n.css("width",n.children().outerWidth()),a.css("width",n.children().outerWidth()),$("#J_siteSwitchHandle").on("click",function(){return i?t():e(),!1}),$("body").on("click.foldingSiteSwitch.mi",function(e){0==$(e.target).parents(".site-switch").length&&i&&t()})}(),$("#J_emailSubscribe").on("submit",function(){var e=$(this);return Xiaomi.utils.checkEmail(e.find('[name="email"]').val())?($.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serialize(),dataType:"jsonp",jsonp:"jsonpcallback",success:function(t){t&&0==t.errno&&e.find(".sub-prompt").children().hide().filter(".success").show()},error:function(){}}),!1):(e.find(".sub-prompt").children().hide().filter(".invalid").show(),!1)})}),Xiaomi.CONST={ShowType:{buy:"",bargain:"[Sale]",gift:"[Gift]",seckill:"[Flash Deal]",special:"[Special]",ernie:"[Shake]",presales:"[Pre-sale]",fcode:"[F-code]"}};